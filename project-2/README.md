# Project 2: AWS Migration and Standardization Sample for On-Premise Servers

## 概要

オンプレミスサーバーのAWS移行と環境標準化を想定した構成設計のサンプルです。ハイブリッドクラウド環境を前提とした段階的移行アプローチを採用しています。

## 構成図

### プレビュー
![On-Premise to AWS Migration Architecture](architecture-diagram.png)

### ファイル
- `Project 2 AWS migration and standardization sample for on-premise servers.drawio` - draw.io編集可能ファイル
- `architecture-diagram.png` - PNG画像ファイル

## 主要な構成要素

### オンプレミス環境
- **Firewall**: 外部からの不正アクセス防止
- **Router**: ネットワークルーティング（冗長構成）
- **Switch**: L2/L3スイッチング（冗長構成）
- **PC / Users**: エンドユーザー端末

### AWS環境

#### ネットワーク構成
- **Region**: ap-northeast-1（東京リージョン）
- **Multi-AZ構成**: 高可用性を考慮
- **VPC**: オンプレミスと接続するプライベートネットワーク
- **Public Subnet**: インターネット接続が必要なリソース配置用
- **Private Subnet**: 内部システム配置用（オンプレと接続）

#### ハイブリッド接続
- **VPN Connection**: オンプレミスとAWS間のセキュアな接続
- **Direct Connect** (オプション): 専用線による高速・安定した接続
- **Transit Gateway** (オプション): 複数VPC・オンプレ接続の集約管理

#### セキュリティ
- **Security Group**: インスタンスレベルのファイアウォール
- **Network ACL**: サブネットレベルのファイアウォール
- **VPN暗号化**: IPsecによる通信の暗号化

## 想定シナリオ

既存のオンプレミスサーバー環境をAWSに移行し、ハイブリッドクラウド環境を構築する際の標準構成です。

### 対象システム例
- 社内基幹システム（ERP、会計システム等）
- ファイルサーバー
- Active Directory / LDAPサーバー
- 業務アプリケーションサーバー
- 監視・バックアップシステム

### 移行対象組織
- 中堅企業のIT部門
- オンプレミスからクラウドへの段階的移行を検討中
- 既存のネットワークインフラを維持しながらクラウド化

## 設計のポイント

### ✅ ハイブリッド接続
- **VPN接続**: オンプレミスとAWS間のセキュアな通信
- **プライベートIPアドレス**: オンプレとAWSで重複しないIPアドレス設計
- **ルーティング制御**: オンプレ⇔AWS間の適切なルーティング設定
- **冗長化**: VPN接続の冗長化（障害対策）

### ✅ セキュリティ
- **多層防御**:
  - オンプレ側: Firewall → Router → Switch
  - AWS側: NACL → Security Group
- **通信暗号化**: VPN/Direct Connectによる暗号化通信
- **アクセス制御**: 最小権限の原則に基づいたSG設計
- **監査ログ**: CloudTrail、VPC Flow Logsによる通信記録

### ✅ 段階的移行
1. **Phase 1: 接続確立**
   - VPN接続の構築
   - 疎通確認、ネットワーク安定性確認
   
2. **Phase 2: 開発環境移行**
   - 開発・検証環境をAWSに移行
   - 動作確認、パフォーマンステスト
   
3. **Phase 3: 本番環境移行**
   - 段階的に本番システムを移行
   - DR（災害復旧）サイトとしての活用
   
4. **Phase 4: 最適化**
   - マネージドサービスへの移行（EC2 → RDS等）
   - Auto Scaling、コスト最適化

### ✅ 標準化
- **命名規則**: リソース命名の統一
- **タグ戦略**: 環境・プロジェクト・コスト管理用タグの設計
- **ネットワーク設計**: IPアドレス体系の標準化
- **セキュリティポリシー**: SG/NACLの標準テンプレート化

### ✅ 高可用性
- Multi-AZ構成による冗長化
- VPN接続の冗長化（複数トンネル）
- オンプレ側ルーター・スイッチの冗長構成

## 移行戦略

### 移行アプローチ

#### 1. ハイブリッドクラウド構成
```
[オンプレミス] <--VPN/Direct Connect--> [AWS]
    既存システム継続運用              新規システム・移行システム
```

- メリット: 既存環境を維持しながら段階的に移行可能
- リスク低減: 問題発生時のロールバックが容易

#### 2. 移行優先順位
**優先度高**:
- 開発・検証環境
- ファイルサーバー（S3/FSx移行）
- バックアップサーバー

**優先度中**:
- Webアプリケーション
- 業務アプリケーション（ステートレス）

**優先度低**:
- 基幹システム（ERP等）
- Active Directory（ハイブリッドAD構成）

### 移行手法

#### Lift and Shift（リフト＆シフト）
- AWS Application Migration Service（MGN）の活用
- 最小限の変更で迅速に移行
- オンプレミスVMをそのままEC2に変換

#### Re-platform（リプラットフォーム）
- ファイルサーバー → Amazon FSx / S3
- 自己管理DB → Amazon RDS
- バックアップ → AWS Backup

## ネットワーク設計例

### IPアドレス設計
```
オンプレミス:
  - 本社ネットワーク: 10.0.0.0/16
  - 支社ネットワーク: 10.1.0.0/16

AWS VPC:
  - VPC CIDR: 10.10.0.0/16
  - Public Subnet (1a): 10.10.1.0/24
  - Public Subnet (1c): 10.10.2.0/24
  - Private Subnet (1a): 10.10.11.0/24
  - Private Subnet (1c): 10.10.12.0/24
```

※オンプレミスとAWSでIPアドレスが重複しないように設計

## 運用設計

### 監視・運用
- **CloudWatch**: AWS環境の監視
- **既存監視ツール**: オンプレミス監視との統合
- **統合ダッシュボード**: ハイブリッド環境全体の可視化

### バックアップ戦略
- **オンプレ → AWS**: オンプレデータのAWSへのバックアップ
- **AWS Backup**: AWS環境の統合バックアップ管理
- **クロスリージョンバックアップ**: DR対策

### ディザスタリカバリ（DR）
- AWS環境をDRサイトとして活用
- RPO/RTOに基づいたバックアップ設計
- 定期的なDR訓練の実施

## コスト試算（参考）

### 初期コスト
- Direct Connect接続費用（オプション）: 初期費用 + 月額
- VPN接続: 無料（データ転送量に応じた課金）

### 月額ランニングコスト（中規模環境想定）
- EC2（サーバー移行）: 約 ¥50,000
- RDS（DB移行）: 約 ¥30,000
- VPN接続 + データ転送: 約 ¥10,000
- S3（ファイルサーバー移行）: 約 ¥5,000
- その他（監視・バックアップ等）: 約 ¥10,000

**合計: 約 ¥105,000/月**

※実際のコストは移行規模・利用状況により大きく変動します

### コスト削減ポイント
- Reserved Instances活用（1年/3年契約）
- Savings Plans適用
- 不要リソースの定期的な見直し

## 移行スケジュール例

| フェーズ | 期間 | 主な作業 |
|---------|------|---------|
| Phase 1: 計画 | 1ヶ月 | 現状分析、移行計画策定、AWS設計 |
| Phase 2: 検証環境構築 | 1ヶ月 | VPC構築、VPN接続、疎通確認 |
| Phase 3: パイロット移行 | 2ヶ月 | 開発環境移行、動作検証 |
| Phase 4: 本番移行準備 | 1ヶ月 | 移行手順確定、リハーサル |
| Phase 5: 本番移行 | 3ヶ月 | 段階的な本番システム移行 |
| Phase 6: 安定化・最適化 | 継続 | 監視、最適化、追加移行 |

**合計: 約8ヶ月〜1年**

## 成功のポイント

1. **経営層のコミットメント**: クラウド移行の意義を組織全体で共有
2. **段階的アプローチ**: リスクを分散し、確実に進める
3. **スキル習得**: AWSトレーニング、認定資格取得
4. **パートナー活用**: AWS APN（Advanced Consulting Partner）との協業
5. **継続的改善**: 移行後も最適化を継続

## 参考リンク

- [AWS VPN](https://aws.amazon.com/jp/vpn/)
- [AWS Direct Connect](https://aws.amazon.com/jp/directconnect/)
- [AWS Hybrid Cloud](https://aws.amazon.com/jp/hybrid/)
- [AWS Prescriptive Guidance（移行戦略）](https://docs.aws.amazon.com/ja_jp/prescriptive-guidance/)

